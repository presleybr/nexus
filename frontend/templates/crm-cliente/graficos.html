<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gr√°ficos - Nexus CRM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Nexus Design System -->
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/animations.css">
    <link rel="stylesheet" href="/static/css/crm-cliente.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .refresh-icon {
            width: 18px;
            height: 18px;
            animation: none;
        }

        .btn-primary:disabled .refresh-icon,
        .nexus-btn-primary:disabled .refresh-icon {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(57, 255, 20, 0.05) 0%, rgba(57, 255, 20, 0.02) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(57, 255, 20, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #39FF14, #2dd40f);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(57, 255, 20, 0.2);
            border-color: rgba(57, 255, 20, 0.4);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: rgba(57, 255, 20, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-icon svg {
            width: 22px;
            height: 22px;
            color: #39FF14;
        }

        .stat-label {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #fff;
            font-family: 'Space Grotesk', sans-serif;
        }

        .stat-trend {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-card {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2);
        }

        .chart-card.full-width {
            grid-column: 1 / -1;
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.125rem;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chart-icon {
            width: 24px;
            height: 24px;
            color: #39FF14;
        }

        .chart-badge {
            background: rgba(57, 255, 20, 0.1);
            color: #39FF14;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .chart-container {
            position: relative;
            height: 320px;
        }

        .loading-spinner {
            text-align: center;
            padding: 4rem;
        }

        .spinner {
            border: 4px solid rgba(57, 255, 20, 0.1);
            border-top: 4px solid #39FF14;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            color: #ef4444;
        }

        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-card.full-width {
                grid-column: 1;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 1.25rem;
            }

            .stat-value {
                font-size: 1.75rem;
            }

            .chart-container {
                height: 280px;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .page-header .btn-primary,
            .page-header .nexus-btn-primary {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="crm-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <img src="/static/images/nexus_Logotipo.png" alt="Nexus" style="height: 80px; margin-bottom: 15px;">
            </div>

            <nav>
                <ul class="sidebar-menu">
                    <li class="menu-item">
                        <a href="/crm/dashboard" class="menu-link">
                            <svg class="menu-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                            Dashboard
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/crm/cadastro-clientes" class="menu-link">
                            <svg class="menu-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                            Clientes
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/crm/whatsapp" class="menu-link">
                            <svg class="menu-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                            </svg>
                            WhatsApp
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/crm/disparos" class="menu-link">
                            <svg class="menu-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                            Disparos
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/crm/boletos" class="menu-link">
                            <svg class="menu-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <line x1="10" y1="9" x2="8" y2="9"></line>
                            </svg>
                            Boletos
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/crm/automacao-canopus" class="menu-link">
                            <svg class="menu-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                <polyline points="7.5 4.21 12 6.81 16.5 4.21"></polyline>
                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                            </svg>
                            Automa√ß√£o Canopus
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/crm/monitoramento" class="menu-link">
                            <svg class="menu-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                            Monitoramento
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/crm/graficos" class="menu-link active">
                            <svg class="menu-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <line x1="12" y1="20" x2="12" y2="10"></line>
                                <line x1="18" y1="20" x2="18" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="16"></line>
                            </svg>
                            Gr√°ficos
                        </a>
                    </li>
                </ul>
            </nav>

            <button class="logout-btn" onclick="logout()">
                <svg style="width: 18px; height: 18px; vertical-align: middle; margin-right: 8px;" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                Sair
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 style="margin: 0; font-size: 2rem; font-weight: 700;">Gr√°ficos e Relat√≥rios</h1>
                    <p style="margin: 0.5rem 0 0; color: rgba(255, 255, 255, 0.6);">An√°lise visual de dados e m√©tricas do sistema</p>
                </div>
                <button class="btn-primary" onclick="carregarGraficos()" id="refreshBtn">
                    <svg class="refresh-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"></path>
                    </svg>
                    <span id="refreshText">Atualizar Dados</span>
                </button>
            </div>

            <!-- Loading State -->
            <div id="loading" class="loading-spinner">
                <div class="spinner"></div>
                <p style="color: rgba(255, 255, 255, 0.6); font-size: 1.125rem;">Carregando dados dos gr√°ficos...</p>
            </div>

            <!-- Content (hidden initially) -->
            <div id="content" style="display: none;">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                            </div>
                            <div class="stat-label">Disparos</div>
                        </div>
                        <div class="stat-value" id="totalDisparos">0</div>
                        <div class="stat-trend">üìà Total acumulado</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                </svg>
                            </div>
                            <div class="stat-label">Boletos</div>
                        </div>
                        <div class="stat-value" id="totalBoletos">0</div>
                        <div class="stat-trend">üìã Gerados no total</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <div class="stat-label">Clientes</div>
                        </div>
                        <div class="stat-value" id="totalClientes">0</div>
                        <div class="stat-trend">üë• Ativos no sistema</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                </svg>
                            </div>
                            <div class="stat-label">Recebido</div>
                        </div>
                        <div class="stat-value" id="totalRecebido">R$ 0,00</div>
                        <div class="stat-trend">üí∞ Valores pagos</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 6v6l4 2"></path>
                                </svg>
                            </div>
                            <div class="stat-label">Pendente</div>
                        </div>
                        <div class="stat-value" id="totalPendente">R$ 0,00</div>
                        <div class="stat-trend">‚è≥ Aguardando pagamento</div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <!-- Disparos por M√™s -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">
                                <svg class="chart-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                                Disparos por M√™s
                            </div>
                            <div class="chart-badge">√öltimos 6 meses</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="chartDisparosMes"></canvas>
                        </div>
                    </div>

                    <!-- Status dos Disparos -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">
                                <svg class="chart-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 6v6l4 2"></path>
                                </svg>
                                Status dos Disparos
                            </div>
                            <div class="chart-badge">Distribui√ß√£o</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="chartStatusDisparos"></canvas>
                        </div>
                    </div>

                    <!-- Boletos por Status -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">
                                <svg class="chart-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                </svg>
                                Boletos por Status
                            </div>
                            <div class="chart-badge">√öltimos 30 dias</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="chartBoletosStatus"></canvas>
                        </div>
                    </div>

                    <!-- Taxa de Convers√£o -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">
                                <svg class="chart-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                </svg>
                                Disparos vs Pagamentos
                            </div>
                            <div class="chart-badge">√öltimos 30 dias</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="chartConversao"></canvas>
                        </div>
                    </div>

                    <!-- Valores Financeiros (full width) -->
                    <div class="chart-card full-width">
                        <div class="chart-header">
                            <div class="chart-title">
                                <svg class="chart-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                    <line x1="12" y1="1" x2="12" y2="23"></line>
                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                </svg>
                                Valores Financeiros
                            </div>
                            <div class="chart-badge">√öltimos 6 meses</div>
                        </div>
                        <div class="chart-container" style="height: 400px;">
                            <canvas id="chartValores"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/static/js/crm-cliente.js"></script>
    <script>
        // Chart instances
        let chartDisparosMes, chartStatusDisparos, chartBoletosStatus, chartConversao, chartValores;

        // Chart.js global configuration
        Chart.defaults.color = '#E0E0E0';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
        Chart.defaults.font.family = 'Inter, sans-serif';

        async function carregarGraficos() {
            const refreshBtn = document.getElementById('refreshBtn');
            const refreshText = document.getElementById('refreshText');

            // Disable button during loading
            refreshBtn.disabled = true;
            refreshText.textContent = 'Carregando...';

            try {
                // Show loading if content is hidden
                if (document.getElementById('content').style.display === 'none') {
                    document.getElementById('loading').style.display = 'block';
                }

                const response = await fetch('/api/crm/graficos');
                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.erro || 'Erro ao carregar dados');
                }

                // Destroy existing charts if they exist
                if (chartDisparosMes) chartDisparosMes.destroy();
                if (chartStatusDisparos) chartStatusDisparos.destroy();
                if (chartBoletosStatus) chartBoletosStatus.destroy();
                if (chartConversao) chartConversao.destroy();
                if (chartValores) chartValores.destroy();

                // Atualizar stats cards
                document.getElementById('totalDisparos').textContent = data.resumo.total_disparos.toLocaleString('pt-BR');
                document.getElementById('totalBoletos').textContent = data.resumo.total_boletos.toLocaleString('pt-BR');
                document.getElementById('totalClientes').textContent = data.resumo.total_clientes.toLocaleString('pt-BR');
                document.getElementById('totalRecebido').textContent = 'R$ ' + data.resumo.total_recebido.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                document.getElementById('totalPendente').textContent = 'R$ ' + data.resumo.total_pendente.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                // 1. Disparos por M√™s (Line Chart)
                const ctxDisparosMes = document.getElementById('chartDisparosMes').getContext('2d');
                chartDisparosMes = new Chart(ctxDisparosMes, {
                    type: 'line',
                    data: {
                        labels: data.disparos_mes.labels,
                        datasets: [{
                            label: 'Disparos',
                            data: data.disparos_mes.data,
                            borderColor: '#39FF14',
                            backgroundColor: 'rgba(57, 255, 20, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointBackgroundColor: '#39FF14',
                            pointBorderColor: '#000',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 12,
                                cornerRadius: 8,
                                titleFont: { size: 14, weight: 'bold' },
                                bodyFont: { size: 13 }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { precision: 0 },
                                grid: { color: 'rgba(255, 255, 255, 0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });

                // 2. Status dos Disparos (Doughnut Chart)
                const ctxStatusDisparos = document.getElementById('chartStatusDisparos').getContext('2d');
                chartStatusDisparos = new Chart(ctxStatusDisparos, {
                    type: 'doughnut',
                    data: {
                        labels: data.status_disparos.labels,
                        datasets: [{
                            data: data.status_disparos.data,
                            backgroundColor: data.status_disparos.background,
                            borderWidth: 3,
                            borderColor: '#000000'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 15, font: { size: 12 } }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 12,
                                cornerRadius: 8
                            }
                        }
                    }
                });

                // 3. Boletos por Status (Pie Chart)
                const ctxBoletosStatus = document.getElementById('chartBoletosStatus').getContext('2d');
                chartBoletosStatus = new Chart(ctxBoletosStatus, {
                    type: 'pie',
                    data: {
                        labels: data.boletos_status.labels,
                        datasets: [{
                            data: data.boletos_status.data,
                            backgroundColor: data.boletos_status.background,
                            borderWidth: 3,
                            borderColor: '#000000'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 15, font: { size: 12 } }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 12,
                                cornerRadius: 8
                            }
                        }
                    }
                });

                // 4. Taxa de Convers√£o (Line Chart)
                const ctxConversao = document.getElementById('chartConversao').getContext('2d');
                chartConversao = new Chart(ctxConversao, {
                    type: 'line',
                    data: {
                        labels: data.conversao.labels,
                        datasets: [
                            {
                                label: 'Disparos',
                                data: data.conversao.disparos,
                                borderColor: '#39FF14',
                                backgroundColor: 'rgba(57, 255, 20, 0.1)',
                                borderWidth: 3,
                                fill: false,
                                tension: 0.4,
                                pointRadius: 4,
                                pointBackgroundColor: '#39FF14',
                                pointBorderColor: '#000',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'Pagamentos',
                                data: data.conversao.pagamentos,
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 3,
                                fill: false,
                                tension: 0.4,
                                pointRadius: 4,
                                pointBackgroundColor: '#10b981',
                                pointBorderColor: '#000',
                                pointBorderWidth: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom',
                                labels: { padding: 15, font: { size: 12 } }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 12,
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { precision: 0 },
                                grid: { color: 'rgba(255, 255, 255, 0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });

                // 5. Valores Financeiros (Bar Chart)
                const ctxValores = document.getElementById('chartValores').getContext('2d');
                chartValores = new Chart(ctxValores, {
                    type: 'bar',
                    data: {
                        labels: data.valores.labels,
                        datasets: [
                            {
                                label: 'Pago',
                                data: data.valores.pago,
                                backgroundColor: 'rgba(16, 185, 129, 0.8)',
                                borderColor: '#10b981',
                                borderWidth: 2,
                                borderRadius: 6
                            },
                            {
                                label: 'Pendente',
                                data: data.valores.pendente,
                                backgroundColor: 'rgba(245, 158, 11, 0.8)',
                                borderColor: '#f59e0b',
                                borderWidth: 2,
                                borderRadius: 6
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom',
                                labels: { padding: 15, font: { size: 12 } }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 12,
                                cornerRadius: 8,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += 'R$ ' + context.parsed.y.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                },
                                grid: { color: 'rgba(255, 255, 255, 0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });

                // Hide loading, show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';

            } catch (error) {
                console.error('Erro ao carregar gr√°ficos:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="error-message">
                        <svg style="width: 48px; height: 48px; margin-bottom: 1rem;" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        <h3 style="margin: 0 0 0.5rem; font-size: 1.25rem;">Erro ao carregar dados</h3>
                        <p style="margin: 0 0 1.5rem; opacity: 0.8;">N√£o foi poss√≠vel carregar os gr√°ficos. Por favor, tente novamente.</p>
                        <button class="btn-primary" onclick="carregarGraficos()">
                            <svg class="refresh-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"></path>
                            </svg>
                            Tentar Novamente
                        </button>
                    </div>
                `;
            } finally {
                // Re-enable button
                refreshBtn.disabled = false;
                refreshText.textContent = 'Atualizar Dados';
            }
        }

        // Load charts on page load
        window.addEventListener('load', carregarGraficos);
    </script>
</body>
</html>
